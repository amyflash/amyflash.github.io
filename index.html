<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…»ç”ŸéŸ³ä¹æ’­æ”¾å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* æŠ¤çœ¼ç»¿è‰²æ¸å˜èƒŒæ™¯ï¼Œä½é¥±å’Œåº¦ä¸åˆºçœ¼ */
        body {
            background: linear-gradient(135deg, #f0f8f0 0%, #e6f5e6 100%);
            min-height: 100vh;
            padding: 20px 15px;
            padding-bottom: 80px; /* ç»™åº•éƒ¨æ’­æ”¾æ ç•™å‡ºç©ºé—´ */
        }
        
        .container {
            max-width: 450px;
            margin: 0 auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(102, 179, 102, 0.1);
            overflow: hidden;
        }
        
        /* æŠ¤çœ¼ç»¿æ¸å˜å¤´éƒ¨ */
        .header {
            background: linear-gradient(90deg, #4a9d58 0%, #3a7d44 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* åŠ è½½çŠ¶æ€æç¤º */
        .loading-tip {
            padding: 15px;
            text-align: center;
            color: #6b8e6b;
            font-size: 14px;
            background: #f8fcf8;
            border-bottom: 1px solid #eaf6ea;
        }
        
        .music-list {
            padding: 15px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        /* æ»šåŠ¨æ¡ç¾åŒ–ï¼ˆæŠ¤çœ¼ï¼‰ */
        .music-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .music-list::-webkit-scrollbar-track {
            background: #eaf6ea;
            border-radius: 3px;
        }
        
        .music-list::-webkit-scrollbar-thumb {
            background: #4a9d58;
            border-radius: 3px;
        }
        
        .music-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            background: #f8fcf8; /* æµ…ç»¿åº•ï¼ŒæŠ¤çœ¼ */
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .music-item:hover {
            background: #eaf6ea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 179, 102, 0.08);
        }
        
        /* æ’­æ”¾ä¸­é«˜äº® - æŸ”å’Œçš„ç»¿è‰² */
        .music-item.active {
            border-left-color: #4a9d58;
            background: #e8f5e9;
        }
        
        /* éŸ³ä¹å›¾æ ‡ - æŠ¤çœ¼ç»¿æ¸å˜ */
        .music-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a9d58 0%, #3a7d44 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 18px;
        }
        
        .music-info {
            flex: 1;
        }
        
        .music-name {
            font-size: 16px;
            font-weight: 500;
            color: #2d472f; /* æ·±ç»¿æ–‡å­—ï¼ŒæŠ¤çœ¼ä¸åˆºçœ¼ */
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .music-url {
            font-size: 10px;
            color: #6b8e6b; /* æµ…ç»¿ç°è‰²ï¼Œé™ä½å¯¹æ¯”åº¦ */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* æ’­æ”¾æŒ‰é’® - æŠ¤çœ¼ç»¿ */
        .play-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #4a9d58;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .play-btn:hover {
            background: #3e8a48;
            transform: scale(1.05);
        }
        
        /* åº•éƒ¨æ’­æ”¾æ  - çº¯ç™½åº•+æµ…ç»¿é˜´å½± */
        .player-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 10px 20px;
            box-shadow: 0 -2px 10px rgba(102, 179, 102, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
        }
        
        .now-playing {
            font-size: 14px;
            color: #2d472f;
            max-width: 60%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .now-playing span {
            color: #4a9d58;
            font-weight: 500;
        }
        
        .control-btns {
            display: flex;
            gap: 15px;
        }
        
        /* æ§åˆ¶æŒ‰é’® - æŠ¤çœ¼ç»¿ */
        .control-btn {
            background: none;
            border: none;
            font-size: 18px;
            color: #4a9d58;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }
        
        .control-btn:hover {
            background: #e8f5e9; /* æµ…ç»¿hoverèƒŒæ™¯ */
        }
        
        /* è¿›åº¦æ¡æ ·å¼ - æŠ¤çœ¼ç»¿ */
        .progress-container {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            height: 4px;
            background: #eaf6ea;
        }
        
        .progress-bar {
            height: 100%;
            background: #4a9d58;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        /* ç©ºåˆ—è¡¨/é”™è¯¯æç¤º */
        .empty-tip, .error-tip {
            text-align: center;
            padding: 30px 0;
            font-size: 14px;
        }
        
        .empty-tip {
            color: #6b8e6b;
        }
        
        .error-tip {
            color: #e53e3e;
        }
        
        /* é€‚é…å°å±æ‰‹æœº */
        @media (max-width: 375px) {
            .music-name {
                font-size: 14px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .player-footer {
                padding: 8px 15px;
            }
            
            .now-playing {
                font-size: 13px;
            }
            
            .control-btn {
                font-size: 16px;
                width: 32px;
                height: 32px;
            }
            
            .music-list {
                max-height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å…»ç”ŸéŸ³ä¹æ’­æ”¾å™¨</h1>
            <p>æŠ¤çœ¼ç»¿è‰²ä¸»é¢˜</p>
        </div>
        
        <!-- åŠ è½½çŠ¶æ€æç¤º -->
        <div class="loading-tip" id="loadingTip">æ­£åœ¨åŠ è½½éŸ³ä¹åˆ—è¡¨...</div>
        
        <!-- åŠ¨æ€ç”Ÿæˆçš„éŸ³ä¹åˆ—è¡¨ -->
        <div class="music-list" id="musicList"></div>
    </div>
    
    <!-- åº•éƒ¨æ’­æ”¾æ  -->
    <div class="player-footer">
        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="now-playing">å½“å‰æ’­æ”¾: <span id="currentMusic">æš‚æ— </span></div>
        <div class="control-btns">
            <button class="control-btn" id="prevBtn">â®</button>
            <button class="control-btn" id="playPauseBtn">â–¶</button>
            <button class="control-btn" id="nextBtn">â­</button>
        </div>
    </div>

    <!-- éŸ³é¢‘æ ‡ç­¾ï¼ˆéšè—ï¼‰ -->
    <audio id="audioPlayer" preload="metadata"></audio>

    <script>
        // å…¨å±€å˜é‡
        const audioPlayer = document.getElementById("audioPlayer");
        const progressBar = document.getElementById("progressBar");
        const playPauseBtn = document.getElementById("playPauseBtn");
        const currentMusicEl = document.getElementById("currentMusic");
        const musicListEl = document.getElementById("musicList");
        const loadingTip = document.getElementById("loadingTip");
        
        let musicData = []; // åŠ¨æ€éŸ³ä¹åˆ—è¡¨
        let currentIndex = -1; // å½“å‰æ’­æ”¾ç´¢å¼•
        let isPlaying = false; // æ’­æ”¾çŠ¶æ€
        
        // ========== æ ¸å¿ƒï¼šé¡µé¢åŠ è½½åè‡ªåŠ¨è¯·æ±‚æœåŠ¡å™¨çš„ playlist.txt ==========
        window.onload = function() {
            fetchPlaylist();
        };
        
        // 1. è¯·æ±‚æœåŠ¡å™¨ç«¯çš„ playlist.txt æ–‡ä»¶
        async function fetchPlaylist() {
            try {
                // è¯·ç¡®ä¿ playlist.txt ä¸è¯¥ HTML æ–‡ä»¶åœ¨åŒä¸€æœåŠ¡å™¨ç›®å½•ä¸‹
                // å¦‚æœä¸åœ¨åŒç›®å½•ï¼Œä¿®æ”¹æ­¤å¤„è·¯å¾„ï¼ˆå¦‚ï¼š/static/playlist.txtï¼‰
                const response = await fetch("playlist.txt");
                
                // æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ
                if (!response.ok) {
                    throw new Error(`è¯·æ±‚å¤±è´¥ï¼š${response.status} ${response.statusText}`);
                }
                
                // è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆUTF-8 ç¼–ç ï¼‰
                const content = await response.text();
                
                // è§£æå¹¶æ¸²æŸ“éŸ³ä¹åˆ—è¡¨
                parsePlaylist(content);
                
            } catch (error) {
                // åŠ è½½å¤±è´¥å¤„ç†
                loadingTip.textContent = "åŠ è½½å¤±è´¥";
                musicListEl.innerHTML = `<div class="error-tip">âŒ éŸ³ä¹åˆ—è¡¨åŠ è½½å¤±è´¥<br>${error.message}<br>è¯·æ£€æŸ¥ playlist.txt æ˜¯å¦å­˜åœ¨</div>`;
                console.error("åŠ è½½ playlist.txt å¤±è´¥ï¼š", error);
            }
        }
        
        // 2. è§£æ playlist å†…å®¹ï¼ˆåˆ†å‰²è¡Œå’Œæ­Œæ›²ä¿¡æ¯ï¼‰
        function parsePlaylist(content) {
            // éšè—åŠ è½½æç¤º
            loadingTip.style.display = "none";
            
            // æ¸…ç©ºåŸæœ‰åˆ—è¡¨
            musicData = [];
            musicListEl.innerHTML = "";
            
            // æŒ‰è¡Œåˆ†å‰²ï¼ˆå…¼å®¹ \n å’Œ \r\nï¼‰
            const lines = content.split(/\r?\n/);
            
            // éå†æ¯ä¸€è¡Œï¼Œè§£ææ­Œæ›²åå’Œåœ°å€
            lines.forEach((line, index) => {
                // è¿‡æ»¤ç©ºè¡Œå’Œæ³¨é‡Šè¡Œï¼ˆä»¥ # å¼€å¤´ï¼‰
                if (!line.trim() || line.trim().startsWith("#")) return;
                
                // æŒ‰ | åˆ†å‰²ï¼ˆåªåˆ†å‰²ç¬¬ä¸€ä¸ª |ï¼Œé¿å…åœ°å€å« | çš„æƒ…å†µï¼‰
                const separatorIndex = line.indexOf("|");
                if (separatorIndex === -1) {
                    console.warn(`ç¬¬ ${index+1} è¡Œæ ¼å¼é”™è¯¯ï¼Œè·³è¿‡ï¼š${line}`);
                    return;
                }
                
                const name = line.substring(0, separatorIndex).trim();
                const url = line.substring(separatorIndex + 1).trim();
                
                // éªŒè¯åœ°å€æ ¼å¼
                if (!url.startsWith("http")) {
                    console.warn(`ç¬¬ ${index+1} è¡ŒéŸ³é¢‘åœ°å€æ— æ•ˆï¼Œè·³è¿‡ï¼š${url}`);
                    return;
                }
                
                musicData.push({ name, url });
            });
            
            // ç”ŸæˆéŸ³ä¹åˆ—è¡¨DOM
            renderMusicList();
            
            // ç©ºåˆ—è¡¨æç¤º
            if (musicData.length === 0) {
                musicListEl.innerHTML = '<div class="empty-tip">ğŸ“„ æœªè§£æåˆ°æœ‰æ•ˆéŸ³ä¹<br>è¯·æ£€æŸ¥ playlist.txt æ ¼å¼ï¼ˆæ­Œæ›²å|éŸ³é¢‘åœ°å€ï¼‰</div>';
            }
        }
        
        // 3. æ¸²æŸ“åŠ¨æ€éŸ³ä¹åˆ—è¡¨
        function renderMusicList() {
            if (musicData.length === 0) return;
            
            let html = "";
            musicData.forEach((item, index) => {
                html += `
                <div class="music-item" data-index="${index}">
                    <div class="music-icon">ğŸµ</div>
                    <div class="music-info">
                        <div class="music-name">${item.name}</div>
                        <div class="music-url">${item.url}</div>
                    </div>
                    <button class="play-btn" onclick="playMusicByIndex(${index})">â–¶</button>
                </div>
                `;
            });
            
            musicListEl.innerHTML = html;
            
            // ç»™éŸ³ä¹é¡¹ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆéæŒ‰é’®åŒºåŸŸï¼‰
            document.querySelectorAll(".music-item").forEach(item => {
                item.addEventListener("click", (e) => {
                    if (e.target.tagName !== "BUTTON") {
                        const index = parseInt(item.dataset.index);
                        playMusicByIndex(index);
                    }
                });
            });
        }
        
        // 4. æ’­æ”¾æŒ‡å®šç´¢å¼•çš„éŸ³ä¹
        function playMusicByIndex(index) {
            if (index < 0 || index >= musicData.length) return;
            
            currentIndex = index;
            const music = musicData[index];
            
            // è®¾ç½®éŸ³é¢‘åœ°å€å¹¶æ’­æ”¾
            audioPlayer.src = music.url;
            audioPlayer.play().then(() => {
                isPlaying = true;
                updatePlayerUI();
                console.log(`æ­£åœ¨æ’­æ”¾: ${music.name} - ${music.url}`);
            }).catch(error => {
                console.error("æ’­æ”¾å¤±è´¥:", error);
                alert(`æ’­æ”¾å¤±è´¥ï¼š${music.name}\nè¯·æ£€æŸ¥éŸ³é¢‘åœ°å€æ˜¯å¦æœ‰æ•ˆ`);
            });
        }
        
        // 5. æ›´æ–°æ’­æ”¾å™¨UIçŠ¶æ€
        function updatePlayerUI() {
            if (currentIndex >= 0 && musicData.length > 0) {
                const currentMusic = musicData[currentIndex];
                currentMusicEl.textContent = currentMusic.name;
                
                // æ›´æ–°æ’­æ”¾/æš‚åœæŒ‰é’®å›¾æ ‡
                playPauseBtn.textContent = isPlaying ? "â¸" : "â–¶";
                
                // ç§»é™¤æ‰€æœ‰activeç±»
                document.querySelectorAll(".music-item").forEach(item => {
                    item.classList.remove("active");
                });
                
                // ç»™å½“å‰æ’­æ”¾é¡¹æ·»åŠ activeç±»
                const activeItem = document.querySelector(`.music-item[data-index="${currentIndex}"]`);
                if (activeItem) activeItem.classList.add("active");
            } else {
                currentMusicEl.textContent = "æš‚æ— ";
                playPauseBtn.textContent = "â–¶";
            }
        }
        
        // 6. ä¸Šä¸€æ›²åŠŸèƒ½
        document.getElementById("prevBtn").addEventListener("click", () => {
            if (musicData.length === 0) {
                alert("æš‚æ— éŸ³ä¹åˆ—è¡¨ï¼");
                return;
            }
            
            currentIndex = currentIndex <= 0 ? musicData.length - 1 : currentIndex - 1;
            playMusicByIndex(currentIndex);
        });
        
        // 7. ä¸‹ä¸€æ›²åŠŸèƒ½
        document.getElementById("nextBtn").addEventListener("click", () => {
            if (musicData.length === 0) {
                alert("æš‚æ— éŸ³ä¹åˆ—è¡¨ï¼");
                return;
            }
            
            currentIndex = currentIndex >= musicData.length - 1 ? 0 : currentIndex + 1;
            playMusicByIndex(currentIndex);
        });
        
        // 8. æ’­æ”¾/æš‚åœåˆ‡æ¢
        playPauseBtn.addEventListener("click", () => {
            if (musicData.length === 0) {
                alert("æš‚æ— éŸ³ä¹åˆ—è¡¨ï¼Œè¯·æ£€æŸ¥ playlist.txtï¼");
                return;
            }
            
            if (currentIndex === -1) {
                // æœªé€‰æ‹©éŸ³ä¹æ—¶é»˜è®¤æ’­æ”¾ç¬¬ä¸€é¦–
                playMusicByIndex(0);
            } else {
                if (isPlaying) {
                    audioPlayer.pause();
                } else {
                    audioPlayer.play();
                }
                isPlaying = !isPlaying;
                updatePlayerUI();
            }
        });
        
        // 9. éŸ³é¢‘çŠ¶æ€ç›‘å¬
        audioPlayer.addEventListener("play", () => {
            isPlaying = true;
            updatePlayerUI();
        });
        
        audioPlayer.addEventListener("pause", () => {
            isPlaying = false;
            updatePlayerUI();
        });
        
        // 10. éŸ³é¢‘ç»“æŸè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€æ›²
        audioPlayer.addEventListener("ended", () => {
            document.getElementById("nextBtn").click();
        });
        
        // 11. æ›´æ–°æ’­æ”¾è¿›åº¦æ¡
        audioPlayer.addEventListener("timeupdate", () => {
            if (audioPlayer.duration) {
                const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                progressBar.style.width = `${progress}%`;
            }
        });
        
        // 12. éŸ³é¢‘åŠ è½½é”™è¯¯å¤„ç†
        audioPlayer.addEventListener("error", (e) => {
            console.error("éŸ³é¢‘åŠ è½½é”™è¯¯:", e);
            const currentMusic = musicData[currentIndex] || { name: "æœªçŸ¥éŸ³ä¹" };
            alert(`æ— æ³•åŠ è½½éŸ³ä¹: ${currentMusic.name}\nè¯·æ£€æŸ¥éŸ³é¢‘åœ°å€æ˜¯å¦æœ‰æ•ˆ`);
            isPlaying = false;
            updatePlayerUI();
        });
    </script>
</body>
</html>